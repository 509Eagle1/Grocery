<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Albertsons Grocery List</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 10px;
  background: #f4f4f4;
}
h1 {
  text-align: center;
  margin-bottom: 5px;
}
.menu {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  margin-bottom: 10px;
}
.menu button, .menu input {
  padding: 5px 8px;
  font-size: 14px;
}
#searchBar {
  flex: 1;
}
#shoppingList {
  list-style-type: none;
  padding-left: 10px;
  margin: 0;
  text-align: left;
}
#shoppingList li {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  text-align: left;
  gap: 8px;
  padding: 4px 0;
  background: white;
  margin-bottom: 4px;
  border-radius: 4px;
  padding-left: 8px;
  cursor: grab;
}
#shoppingList li:active {
  cursor: grabbing;
  background: #d8eaff;
}
#shoppingList li.checked span {
  text-decoration: line-through;
  color: gray;
}
.drag-over {
  border: 2px dashed #007BFF;
}
</style>
</head>
<body>

<h1>Albertsons Grocery List</h1>

<div class="menu">
  <button onclick="clearChecks()">Clear All Checks</button>
  <input type="text" id="searchBar" placeholder="Search items..." onkeyup="searchItems()">
</div>

<ul id="shoppingList">
  <li draggable="true"><input type="checkbox"> <span>Milk</span></li>
  <li draggable="true"><input type="checkbox"> <span>Eggs</span></li>
  <li draggable="true"><input type="checkbox"> <span>Bread</span></li>
  <li draggable="true"><input type="checkbox"> <span>Cheese</span></li>
  <li draggable="true"><input type="checkbox"> <span>Apples</span></li>
</ul>

<script>
function clearChecks() {
  document.querySelectorAll('#shoppingList input[type="checkbox"]').forEach(cb => cb.checked = false);
}

function searchItems() {
  const filter = document.getElementById('searchBar').value.toLowerCase();
  document.querySelectorAll('#shoppingList li').forEach(li => {
    const text = li.textContent.toLowerCase();
    li.style.display = text.includes(filter) ? '' : 'none';
  });
}

// === Drag and Drop Sorting ===
const list = document.getElementById('shoppingList');
let draggedItem = null;

list.addEventListener('dragstart', e => {
  if (e.target.tagName === 'LI') {
    draggedItem = e.target;
    e.target.style.opacity = '0.5';
  }
});

list.addEventListener('dragend', e => {
  if (draggedItem) {
    draggedItem.style.opacity = '1';
    draggedItem = null;
  }
});

list.addEventListener('dragover', e => {
  e.preventDefault();
  const afterElement = getDragAfterElement(list, e.clientY);
  const dragging = document.querySelector('.dragging');
});

list.addEventListener('drop', e => {
  e.preventDefault();
  const afterElement = getDragAfterElement(list, e.clientY);
  if (afterElement == null) {
    list.appendChild(draggedItem);
  } else {
    list.insertBefore(draggedItem, afterElement);
  }
  saveNewOrder();
});

list.addEventListener('dragenter', e => {
  if (e.target.tagName === 'LI') e.target.classList.add('drag-over');
});

list.addEventListener('dragleave', e => {
  if (e.target.tagName === 'LI') e.target.classList.remove('drag-over');
});

function getDragAfterElement(container, y) {
  const draggableElements = [...container.querySelectorAll('li:not(.dragging)')];
  return draggableElements.reduce((closest, child) => {
    const box = child.getBoundingClientRect();
    const offset = y - box.top - box.height / 2;
    if (offset < 0 && offset > closest.offset) {
      return { offset: offset, element: child };
    } else {
      return closest;
    }
  }, { offset: Number.NEGATIVE_INFINITY }).element;
}

function saveNewOrder() {
  const items = [...document.querySelectorAll('#shoppingList li span')].map(span => span.textContent);
  console.log("New order saved:", items);
  // TODO: Replace console.log with GitHub save function if wired
}
</script>

</body>
</html>
